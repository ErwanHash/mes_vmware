# d√©clencher le playbook :
# ansible-playbook premier_playbook.yml -b --ask-become-pass
---
- hosts: localhost

  tasks:
    - name : Include secret items
      include_vars:
        file: secrets.yml
        name: secret

    - name: ajouter un groupe de ports sur le vSwitch0 avec un ID de VLAN
      community.vmware.vmware_portgroup:
        hosts: esxi3.formation.lan
        hostname: vcsa.formation.lan
        username: erwan
        password: F0rmation!
        switch: vSwitch0
        portgroup_name: VLAN_Erwan
        network_policy:
            promiscuous_mode: True
        vlan_id: 0100
        validate_certs: no
        state: present


    # - name: Add tags to a virtual machine
    #   community.vmware.vmware_tag_manager:
    #     hostname: vcsa.formation.lan
    #     username: erwan
    #     password: F0rmation!
    #     tag_names:
    #       - Proprio:Erwan
    #     state: add
    #   delegate_to: localhost
    #   object-name: Deb_Erwan
    #   object_type: VirtualMachine

    # - name: Create Deb_Erwan
    #   connection: local
    #   gather_facts: no
    #   tasks:
    #   - name: Clone the template
    #     vmware_guest:
    #       hostname: 78.192.40.154
    #       username: erwan
    #       password: F0rmation!
    #       validate_certs: False
    #       name: Deb_Erwan
    #       template: DebTemplate
    #       datacenter: DC1
    #       folder: /Datacenter/Pas Touche !/Modeles/DebTemplate
    #       state: poweredon
    #       wait_for_ip_address: yes
...